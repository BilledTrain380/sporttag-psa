# Gradle
# Build your Java project and run tests with Gradle using a Gradle wrapper script.
# Add steps that analyze code, save build artifacts, deploy, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/java

name: $(Date:yyyyMMdd)$(Rev:.r)

trigger:
  - master
  - develop
  - release/*
  - hotfix/*
  - feature/*

pr:
  - master
  - develop
  - release/*

variables:
  profileProd: prod
  frontendDir: app/frontend

resources:
  containers:
    - container: openjdk
      image: openjdk:8-slim

stages:

  - stage: analyze_test_build
    displayName: 'Analyze, test, build'
    jobs:
      - job: Backend
        pool:
          vmImage: Ubuntu-18.04

        container: openjdk

        steps:
          - script: printenv
          - script: './gradlew junitPlatformTest'
            displayName: 'Test Backend'

      - job: Frontend
        pool:
          vmImage: Ubuntu-18.04

        steps:
          - script: printenv
          - task: NodeTool@0
            displayName: 'Setup environment'
            inputs:
              versionSpec: '10.x'

          - script: npm ci
            displayName: 'Install dependencies'
            workingDirectory: $(frontendDir)

          - script: npm run lint
            displayName: 'Lint'
            workingDirectory: $(frontendDir)

          - script: npm run test -- --watch=false
            displayName: 'Run tests'
            workingDirectory: $(frontendDir)
